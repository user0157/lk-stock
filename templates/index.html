<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®è¡¨å±•ç¤º</title>

    <!-- æ ·å¼ -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

    <!-- ä½ å·²æœ‰çš„æ’ä»¶ -->
    <script src="{{ url_for('static', filename='plugins/table-filter.js') }}"></script>
    <script src="{{ url_for('static', filename='plugins/table-sort-v2.js') }}"></script>
</head>

<body>

    <!-- é¡¶éƒ¨æ  -->
    <div class="top-bar">
        <h2>ğŸ“Š æ¥æ”¶åˆ°çš„æ•°æ®</h2>

        <a href="{{ url_for('auth.logout') }}" class="logout-btn">
            é€€å‡ºç™»å½•
        </a>
    </div>

    <!-- æœç´¢æ¡† -->
    <div class="search-box">
        <input
            type="text"
            id="tableSearch"
            placeholder="ğŸ” æœç´¢è¡¨æ ¼å†…å®¹..."
            onkeyup="filterTable()"
        >

        <button
            type="button"
            class="refresh-btn"
            onclick="window.location.reload();"
            title="åˆ·æ–°é¡µé¢"
        >
            åˆ·æ–°
        </button>
    </div>

    <!-- è¡¨æ ¼ -->
    <div class="table-container">
        <table class="table-sort table-filter">
            <thead>
                <tr>
                    {% for h in headers %}
                        <th>{{ h }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for row in data %}
                <tr>
                    {% for h in headers %}
                        <td>{{ row[h] }}</td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- æœç´¢ JS -->
    <script>
        let debounceTimer;

        // 1. åœ¨é¡µé¢åŠ è½½æ—¶ä¸€æ¬¡æ€§ç¼“å­˜è¡Œçš„æ–‡æœ¬å†…å®¹
        const rows = Array.from(document.querySelectorAll("table tbody tr"));
        const rowTexts = rows.map(row => row.textContent.toLowerCase());

        // 2. æ‰§è¡Œè¿‡æ»¤æ“ä½œ
        function filterTable() {
            clearTimeout(debounceTimer);

            // è®¾ç½® debounceï¼Œé¿å…æ¯æ¬¡æŒ‰é”®éƒ½è§¦å‘è¿‡æ»¤
            debounceTimer = setTimeout(() => {
                const filter = document.getElementById("tableSearch").value.toLowerCase();

                rows.forEach((row, i) => {
                    // æ ¹æ®ç¼“å­˜çš„ rowTexts æ¥è¿‡æ»¤æ˜¾ç¤º
                    row.style.display = rowTexts[i].includes(filter) ? "" : "none";
                });
            }, 300);  // 300ms å»¶è¿Ÿæ‰§è¡Œè¿‡æ»¤
        }
    </script>

</body>
</html>
