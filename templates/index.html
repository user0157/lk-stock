{% extends "base.html" %}

{% block title %}æ•°æ®è¡¨å±•ç¤º{% endblock %}

{% block extra_css %}
    <!-- plugins -->
{% endblock %}

{% block content %}

    <div class="top-bar">
        <h2>ğŸ“Š æ¥æ”¶åˆ°çš„æ•°æ®</h2>

        <a href="{{ url_for('auth.logout') }}" class="logout-btn">
            é€€å‡ºç™»å½•
        </a>
    </div>

    <div class="search-box">
        <input
            type="text"
            id="tableSearch"
            placeholder="ğŸ” æœç´¢è¡¨æ ¼å†…å®¹..."
            onkeyup="filterTable()"
        >

        <button
            type="button"
            class="refresh-btn"
            onclick="window.location.reload();"
            title="åˆ·æ–°é¡µé¢"
        >
            åˆ·æ–°
        </button>
    </div>

    <div class="table-container">
        <table class="table-sort table-filter">
            <thead>
                <tr>
                    {% for h in headers %}
                        <th>{{ h }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for row in data %}
                <tr>
                    {% for h in headers %}
                        <td>{{ row[h] }}</td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

{% endblock %}

{% block scripts %}
    <script src="{{ url_for('static', filename='plugins/table-filter.js') }}"></script>
    <script src="{{ url_for('static', filename='plugins/table-sort-v2.js') }}"></script>

    <script>
        let debounceTimer;
        const rows = Array.from(document.querySelectorAll("table tbody tr"));
        const rowTexts = rows.map(row => row.textContent.toLowerCase());

        function filterTable() {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(() => {
                const filter = document.getElementById("tableSearch").value.toLowerCase();
                rows.forEach((row, i) => {
                    row.style.display = rowTexts[i].includes(filter) ? "" : "none";
                });
            }, 300);
        }
    </script>
{% endblock %}